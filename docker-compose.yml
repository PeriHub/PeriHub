version: "3"

services:
  periHubApi:
    build:
      context: api/.
      args:
        EXTERNAL: ${EXTERNAL}
        SMETANA: ${SMETANA}
        GITLAB_TOKEN: ${GITLAB_TOKEN}
        DEV: ${DEV}
    container_name: perihub_periHubApi
    image: peri_hub_api_image
    ports:
      - 6020:80
    volumes:
      - ${VOLUME}peridigmJobs:/app/peridigmJobs
      - ${VOLUME}rsaFiles:/app/rsaFiles
    networks:
      - backend

  periHubGui:
    build:
      context: gui/.
      args:
        DEV: ${DEV}
    container_name: perihub_periHubGui
    image: peri_hub_gui_image
    ports:
      - 6010:80
    networks:
      - backend

  periHubGui2:
    build:
      context: quasar-gui/.
    container_name: perihub_periHubGui2
    image: peri_hub_gui2_image
    ports:
      - 6010:80
    networks:
      - backend

  peridigm:
    # build:
    #   context: peridigm/.
    # args:
    #   GITHUB_USER: ${GITHUB_USER}
    #   GITHUB_TOKEN: ${GITHUB_TOKEN}
    container_name: perihub_peridigm
    image: harbor.fa-services.intra.dlr.de/peridynamik/peridigm_image
    ports:
      - 6030:80
    volumes:
      - ${VOLUME}peridigmJobs:/app/peridigmJobs
    networks:
      - backend

  paraview:
    build:
      context: paraview/.
    container_name: perihub_paraview
    image: paraview_image
    volumes:
      - paraView_volume:/app/paraView

  trame:
    build:
      context: trame/.
      args:
        GITLAB_TOKEN: ${GITLAB_TOKEN}
    container_name: perihub_trame
    image: trame_image
    ports:
      - 6040:80
      - 6041:6041
      - 6042:6042
      - 6043:6043
      - 6044:6044
      - 6045:6045
    volumes:
      - ${VOLUME}peridigmJobs:/app/peridigmJobs
      - paraView_volume:/app/paraView

  cron:
    build: cron/.
    container_name: perihub_cron
    image: cron_image

volumes:
  paraView_volume:

networks:
  backend:
    driver: bridge
